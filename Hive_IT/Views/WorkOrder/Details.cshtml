@model Hive_IT.Models.WorkOrders.OrderViewModel
@{
    ViewData["Title"] = "Work Order Details";
    //TODO: Figure out style of details page
}

<div class="text-center details-display">
    <h1>Work Order: @Model.OrderNumber</h1><br />

    @if (Model.Status == "Complete" && !User.IsInRole("Admin"))
    {
        <label asp-for="Status"></label>
        <select disabled asp-for="Status" asp-items="@Model.StatusList"></select>
    }
    else
    {
        <label asp-for="Status"></label>
        <select asp-for="Status" asp-items="@Model.StatusList"></select>
    }
   
    <b>Last Updated &#64 </b>@Model.StatusChangedAt
    <br />
    <a href="@Url.Action("Profile", "Customer", new {id= Model.CustomerID })">@Model.CustomerName</a>
    <p>Phone numbers: </p>
    @foreach (var phone in Model.Phones)
    {
        <p>@phone.PhoneNumber</p>
    }
    <p>Emails: </p>
    @foreach (var email in Model.Emails)
    {
        <p>@email.Email</p>
    }
    @{
        //TODO: Link shipping button to a address view/edit page
    }
    <button class="btn btn-primary">Show Shipping Information</button><br /><hr />

    @foreach (var device in Model.LinkedDevices)
    {

        if (!User.IsInRole("Admin"))
        {
            if (Model.Status != "Completed" && device.Status != "Picked Up")
            {
                <div class="clearfix">
                    <a asp-action="Update" asp-route-deviceNumber="@device.DeviceId" class="btn btn-info pull-right">
                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Update Device
                    </a>
                </div>
            }
            else
            {
                <div>
                    <br />
                </div>

            }
        }
        else
        {
            <div class="clearfix">
                <a asp-action="Update" asp-route-deviceNumber="@device.DeviceId" class="btn btn-info pull-right">
                    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Update Device
                </a>
            </div>
        }


        <h2 style="display: inline-block">@device.Manufacturer @device.Model SN: @device.Serial</h2>
        <p><b>Status:</b> @device.Status <b>Last updated &#64 </b>@device.StatusLastUpdatedAt</p><br />
        <p>Password: @device.Password Provider: @device.Provider</p><br />
        <label asp-for="@device.Problem"></label>
        <textarea readonly class="col-xs-12 text-center" rows="3">@device.Problem</textarea>
        <br />
        <label asp-for="@device.Notes"></label>
        <textarea readonly class="col-xs-12 text-center" rows="5">@device.Notes</textarea>
       <div class="clearfix col-xs-12">
           <br /><hr />
       </div>
       
    }

    @if (!User.IsInRole("Admin") && Model.Status == "Complete")
    {
        <div class="clearfix">           
            <br />
        </div>

    }
    else
    {
        <div class="clearfix">
            <br />
            <a href="@Url.Action("Add", "WorkOrder", new {order = Model.OrderNumber })" class="btn btn-success bottom">
                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add a device to this workorder
            </a>
            <br />
        </div>
    }  
</div>

